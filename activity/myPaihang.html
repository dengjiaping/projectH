<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="format-detection" content="telephone=no"/>

    <title>我的排行</title>
    <meta name="keywords" content="后会有期"/>
    <meta name="description" content="后会有期"/>

    <script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.js"></script>
    <script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>


    <script src="js/key.js"></script>
    <script src="js/common.js"></script>

    <link rel="stylesheet" href="css/swiper.min.css"/>
    <link rel="stylesheet" href="css/common.css"/>
    <link rel="stylesheet" href="css/css.css"/>

</head>
<body>

<!--card轮播-->
<div class="darenbang_container">

    <div class="darenbang">
        <img src="images/my_daren_toptitle.png" class="darenbang_titleimg" alt=""/>

        <div class="daren_container">

            <!-- 组织活动次数-createRoomMaster-->
            <div class="one_darenbang">
                <div class="daren_paihang_title">
                    <ul>
                        <li style="width: 25%;text-align: center;">排名</li>
                        <li style="width: 40%;padding-left: 35px;">昵称</li>
                        <li style="width: 35%;text-align: center;">组织活动次数</li>
                        <div class="clear"></div>
                    </ul>
                </div>
                <!-- 组织活动次数-->
                <div class="daren_paihang_container">
                    <div class="daren_paihang" id="createRoomMaster">
                        <div class="nvshen_paihang_paixu">
                            <h1>0</h1>
                        </div>
                        <div class="nvshen_paihang_user">
                            <img src="images/tx2.jpg" alt=""/>
                            <h1>----</h1>
                            <div class="clear"></div>
                        </div>
                        <div class="nvshen_fenshu">0</div>
                        <div class="clear"></div>
                    </div>
                </div>
            </div>

            <!-- 好友最多-friendMaster-->
            <div class="one_darenbang">
                <div class="daren_paihang_title">
                    <ul>
                        <li style="width: 25%;text-align: center;">排名</li>
                        <li style="width: 45%;padding-left: 35px;">昵称</li>
                        <li style="width: 30%;text-align: center;">好友最多</li>
                        <div class="clear"></div>
                    </ul>
                </div>

                <!-- 好友最多-friendMaster-->
                <div class="daren_paihang_container">
                    <div class="daren_paihang" id="friendMaster">
                        <div class="nvshen_paihang_paixu">
                            <h1>0</h1>
                        </div>
                        <div class="nvshen_paihang_user">
                            <img src="images/tx2.jpg" alt=""/>
                            <h1>----</h1>
                            <div class="clear"></div>
                        </div>
                        <div class="nvshen_fenshu">0</div>
                        <div class="clear"></div>
                    </div>

                </div>
            </div>

            <!-- 狼人杀参与次数最多-joinWerewolfMaster-->
            <div class="one_darenbang">
                <div class="daren_paihang_title">
                    <ul>
                        <li style="width: 25%;text-align: center;">排名</li>
                        <li style="width: 40%;padding-left: 35px;">昵称</li>
                        <li style="width: 35%;text-align: center;">参加狼人杀次数</li>
                        <div class="clear"></div>
                    </ul>
                </div>

                <!-- 狼人杀参与次数最多-joinWerewolfMaster-->
                <div class="daren_paihang_container">
                    <div class="daren_paihang" id="joinWerewolfMaster">
                        <div class="nvshen_paihang_paixu">
                            <h1>0</h1>
                        </div>
                        <div class="nvshen_paihang_user">
                            <img src="images/tx2.jpg" alt=""/>
                            <h1>----</h1>
                            <div class="clear"></div>
                        </div>
                        <div class="nvshen_fenshu">0</div>
                        <div class="clear"></div>
                    </div>

                </div>
            </div>

            <!-- 排行榜分数总和最高-maxScoreMaster-->
            <div class="one_darenbang">
                <div class="daren_paihang_title">
                    <ul>
                        <li style="width: 25%;text-align: center;">排名</li>
                        <li style="width: 40%;padding-left: 35px;">昵称</li>
                        <li style="width: 35%;text-align: center;">排行榜分数总和</li>
                        <div class="clear"></div>
                    </ul>
                </div>

                <!-- 排行榜分数总和最高-->
                <div class="daren_paihang_container">
                    <div class="daren_paihang" id="maxScoreMaster">
                        <div class="nvshen_paihang_paixu">
                            <h1>0</h1>
                        </div>
                        <div class="nvshen_paihang_user">
                            <img src="images/tx2.jpg" alt=""/>
                            <h1>----</h1>
                            <div class="clear"></div>
                        </div>
                        <div class="nvshen_fenshu">0</div>
                        <div class="clear"></div>
                    </div>

                </div>
            </div>

            <!-- 狼人杀排行第一-werewolfMaster-->
            <div class="one_darenbang">
                <div class="daren_paihang_title">
                    <ul>
                        <li style="width: 25%;text-align: center;">排名</li>
                        <li style="width: 40%;padding-left: 35px;">昵称</li>
                        <li style="width: 35%;text-align: center;">狼人杀分数</li>
                        <div class="clear"></div>
                    </ul>
                </div>

                <!-- 狼人杀排行第一-werewolfMaster-->
                <div class="daren_paihang_container">
                    <div class="daren_paihang" id="werewolfMaster">
                        <div class="nvshen_paihang_paixu">
                            <h1>0</h1>
                        </div>
                        <div class="nvshen_paihang_user">
                            <img src="images/tx2.jpg" alt=""/>
                            <h1>----</h1>
                            <div class="clear"></div>
                        </div>
                        <div class="nvshen_fenshu">0</div>
                        <div class="clear"></div>
                    </div>

                </div>
            </div>

            <!-- 异性好友最多的女性-womanFriendMaster-->
            <div class="one_darenbang">
                <div class="daren_paihang_title">
                    <ul>
                        <li style="width: 25%;text-align: center;">排名</li>
                        <li style="width: 40%;padding-left: 35px;">昵称</li>
                        <li style="width: 35%;text-align: center;">异性好友最多(女生)</li>
                        <div class="clear"></div>
                    </ul>
                </div>

                <!-- 异性好友最多的女性-womanFriendMaster-->
                <div class="daren_paihang_container">
                    <div class="daren_paihang" id="womanFriendMaster">
                        <div class="nvshen_paihang_paixu">
                            <h1>0</h1>
                        </div>
                        <div class="nvshen_paihang_user">
                            <img src="images/tx2.jpg" alt=""/>
                            <h1>----</h1>
                            <div class="clear"></div>
                        </div>
                        <div class="nvshen_fenshu">0</div>
                        <div class="clear"></div>
                    </div>

                </div>
            </div>

            <!-- 异性好友最多的男性-manFriendMaster-->
            <div class="one_darenbang">
                <div class="daren_paihang_title">
                    <ul>
                        <li style="width: 25%;text-align: center;">排名</li>
                        <li style="width: 40%;padding-left: 35px;">昵称</li>
                        <li style="width: 35%;text-align: center;">异性好友最多(男生)</li>
                        <div class="clear"></div>
                    </ul>
                </div>

                <!-- 异性好友最多的男性-manFriendMaster-->
                <div class="daren_paihang_container">
                    <div class="daren_paihang" id="manFriendMaster">
                        <div class="nvshen_paihang_paixu">
                            <h1>0</h1>
                        </div>
                        <div class="nvshen_paihang_user">
                            <img src="images/tx2.jpg" alt=""/>
                            <h1>----</h1>
                            <div class="clear"></div>
                        </div>
                        <div class="nvshen_fenshu">0</div>
                        <div class="clear"></div>
                    </div>

                </div>
            </div>

            <!-- 金色好友最多-goldenFriendMaster-->
            <div class="one_darenbang">
                <div class="daren_paihang_title">
                    <ul>
                        <li style="width: 25%;text-align: center;">排名</li>
                        <li style="width: 40%;padding-left: 35px;">昵称</li>
                        <li style="width: 35%;text-align: center;">金色好友最多</li>
                        <div class="clear"></div>
                    </ul>
                </div>

                <!-- 金色好友最多-goldenFriendMaster-->
                <div class="daren_paihang_container">
                    <div class="daren_paihang" id="goldenFriendMaster">
                        <div class="nvshen_paihang_paixu">
                            <h1>0</h1>
                        </div>
                        <div class="nvshen_paihang_user">
                            <img src="images/tx2.jpg" alt=""/>
                            <h1>----</h1>
                            <div class="clear"></div>
                        </div>
                        <div class="nvshen_fenshu">0</div>
                        <div class="clear"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!---tishi---->
<section>
    <div class="tishi">
        <div class="distable">
            <div class="distabcell">
                <div class="tishi_val">
                    <!--对不起，您的抽奖次数已用完-->
                </div>
            </div>
        </div>
    </div>
</section>
<!---tishi---->

</body>


<!--Swiper切换-->
<script src="js/swiper.min.js"></script>
<!--达人榜--高度-->
<script>
    $(document).ready(function () {
        //card高度+++++
        $(".darenbang_container").height($(window).height()-50);
        //card高度-----
        $(".daren_container").height($(".darenbang").height()-$(".darenbang_titleimg").height());
    })
</script>


<!--页面刚加载时的数据-->
<script>
    var code;
    $(function () {
        code = getQueryString("code");
        load();
        login();
    });

    function login(){
        if(code){
            var isLogin = (localStorage.getItem("token") && localStorage.getItem("userid"));
            if(!isLogin){
                $.ajax({
                    async: false,
                    type:'post',
                    dataType:'json',
                    url:ContextPath+'view/login',
                    data: {"code":code},
                    success:function(json){
                        if (json.success) {
                            var data = json.data;
                            localStorage.setItem("userid", data.id);
                            localStorage.setItem("token", data.token);
                        }
                        if (!json.success) {
                            console.dir(json.msg);
                        }
                    },
                    error: function (e) {
                        if(localStorage.getItem("userid")){
                            location.href = 'https://hzease.com/activity/myPaihang.html';
                        }else{
                            location.href = 'https://hzease.com/activity/myPaihang.html';
                        }
                    }
                });
            }
        }
    }

    function load() {
        var isLogin= (localStorage.getItem("token") && localStorage.getItem("userid"));
        if(!isLogin){
            getcode();
            return;
        }
        $.ajax({
            type:'post',
            dataType:'json',
            url:ContextPath+'view/findMyMaster',
            data: {"token":localStorage.getItem("token"),"userId":localStorage.getItem("userid")},
            success:function(json){
                if(!json.success){
                    console.dir(json.msg);
                    if(json.msg == '登录失效'){
                        getcode();
                        return;
                    }
                }
                if(json.success){
                    var data = json.data;
                    console.dir(json.data);
                    $(".nvshen_paihang_user").empty().append('<img src="//tomeet-app-files.oss-cn-hangzhou.aliyuncs.com/user/'+localStorage.getItem("userid")+'/avatar?x-oss-process=image/resize,m_lfit,w_72,h_72" alt=""/>'+
                            '<h1>'+data.nickname+'</h1>'+
                            '<div class="clear"></div>');

                    // 组织活动最多
                    if(data.createRoomMaster.length == 0){
                        $("#createRoomMaster .nvshen_paihang_paixu h1").empty().append("暂无");
                    }
                    if(data.createRoomMaster.length > 0){
                        $each(data.createRoomMaster, function (index,obj) {
                            $("#createRoomMaster .nvshen_paihang_paixu h1").empty().append(obj.order);
                            $("#createRoomMaster .nvshen_fenshu").empty().append(obj.count);
                        })
                    }

                    //好友最多
                    if(data.friendMaster.length == 0){
                        $("#friendMaster .nvshen_paihang_paixu h1").empty().append("暂无");
                    }
                    if(data.friendMaster.length > 0){
                        $.each(data.friendMaster, function (index,obj) {
                            $("#friendMaster .nvshen_paihang_paixu h1").empty().append(obj.order);
                            $("#friendMaster .nvshen_fenshu").empty().append(obj.count);
                        })
                    }

                    //参加狼人杀次数
                    if(data.joinWerewolfMaster.length == 0){
                        $("#joinWerewolfMaster .nvshen_paihang_paixu h1").empty().append("暂无");
                    }
                    if(data.joinWerewolfMaster.length > 0){
                        $.each(data.joinWerewolfMaster, function (index,obj) {
                            $("#joinWerewolfMaster .nvshen_paihang_paixu h1").empty().append(obj.order);
                            $("#joinWerewolfMaster .nvshen_fenshu").empty().append(obj.count);
                        })
                    }

                    //排行榜总分最高
                    if(data.maxScoreMaster.length == 0){
                        $("#maxScoreMaster .nvshen_paihang_paixu h1").empty().append("暂无");
                    }
                    if(data.maxScoreMaster.length > 0){
                        $.each(data.maxScoreMaster, function (index,obj) {
                            $("#maxScoreMaster .nvshen_paihang_paixu h1").empty().append(obj.order);
                            $("#maxScoreMaster .nvshen_fenshu").empty().append(obj.count);
                        })
                    }

                    //狼人杀分数排行
                    if(data.werewolfMaster.length == 0){
                        $("#werewolfMaster .nvshen_paihang_paixu h1").empty().append("暂无");
                    }
                    if(data.werewolfMaster.length > 0){
                        $.each(data.werewolfMaster, function (index,obj) {
                            $("#werewolfMaster .nvshen_paihang_paixu h1").empty().append(obj.order);
                            $("#werewolfMaster .nvshen_fenshu").empty().append(obj.count);
                        })
                    }

                    //异性好友最多的女生
                    if(data.womanFriendMaster.length == 0){
                        $("#womanFriendMaster .nvshen_paihang_paixu h1").empty().append("暂无");
                    }
                    if(data.womanFriendMaster.length > 0){
                        $.each(data.womanFriendMaster, function (index,obj) {
                            $("#womanFriendMaster .nvshen_paihang_paixu h1").empty().append(obj.order);
                            $("#womanFriendMaster .nvshen_fenshu").empty().append(obj.count);
                        })
                    }

                    //异性好友最多的男生
                    if(data.manFriendMaster.length == 0){
                        $("#manFriendMaster .nvshen_paihang_paixu h1").empty().append("暂无");
                    }
                    if(data.manFriendMaster.length > 0){
                        $.each(data.manFriendMaster, function (index,obj) {
                            $("#manFriendMaster .nvshen_paihang_paixu h1").empty().append(obj.order);
                            $("#manFriendMaster .nvshen_fenshu").empty().append(obj.count);
                        })
                    }

                    //金色好友最多
                    if(data.goldenFriendMaster.length == 0){
                        $("#goldenFriendMaster .nvshen_paihang_paixu h1").empty().append("暂无");
                    }
                    if(data.goldenFriendMaster.length > 0){
                        $.each(data.goldenFriendMaster, function (index,obj) {
                            $("#goldenFriendMaster .nvshen_paihang_paixu h1").empty().append(obj.order);
                            $("#goldenFriendMaster .nvshen_fenshu").empty().append(obj.count);
                        })
                    }


                }
            },
            error:function (e) {
                $(".tishi").fadeIn(500);
                $(".tishi_val").html('数据加载失败');
                tishi_out();
            }
        });
    }

    function getcode() {
        localStorage.clear();
        var url_code = 'https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx1455b640ec310a00&redirect_uri=' + location.href + '&response_type=code&scope=snsapi_login&state=1#wechat_redirect';
//        var url_code = 'https://open.weixin.qq.com/connect/qrconnect?appid=wx1455b640ec310a00&redirect_uri='+location.href+'&response_type=code&scope=snsapi_login&state=1#wechat_redirect';
        location.href = url_code;
    }
</script>
<!--页面刚加载时的数据-->
<script>
    function tishi_out() {
        setTimeout(function () {
            $(".tishi").fadeOut(500);
        },1500)
    }//提示框2秒后消失
</script>
</html>