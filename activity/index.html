<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="format-detection" content="telephone=no"/>

    <title>活动</title>
    <meta name="keywords" content="后会有期"/>
    <meta name="description" content="后会有期"/>

    <script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.js"></script>
    <script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>

    <script src="https://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script><!--微信JSsdk-->
    <!--魔窗-->
    <script src="https://static.mlinks.cc/scripts/dist/mlink.min.js"></script>

    <!-- 微信jssdk-->
    <srcipt src="https://res.wx.qq.com/open/js/jweixin-1.2.0.js"></srcipt>

    <!-- 接口前缀-->
    <script src="js/key.js"></script>
    <script src="js/common.js"></script>

    <link rel="stylesheet" href="css/swiper.min.css"/>
    <link rel="stylesheet" href="css/zp.css"/>
    <link rel="stylesheet" href="css/common.css"/>
    <link rel="stylesheet" href="css/css.css"/>
</head>
<body>
<div id="userId"></div>

<!--card轮播-->
<div class="swiper-container swiper1">
    <div class="swiper-wrapper">
        <div class="swiper-slide">
            <div class="card_container" style="background: transparent!important;">
            </div>
        </div>


        <!-- card1  -------->
        <div class="swiper-slide">
            <div class="card_container card_container1">
                <a href="" class="activity_upload" id="activity_upload">下载APP</a>
            </div>
        </div>
        <!-- card1  -->


        <!-- card2 ----转盘抽奖---->
        <div class="swiper-slide">
            <div class="card_container card_container2">
                <img src="images/zp_title.png" alt=""/>
                <div class="zp_top">
                    <h1><!--奖池剩余金额：0.00元--></h1>
                    <h2><!--参与人数：85人--></h2>
                    <div class="clear"></div>
                </div>
                <div id="zp" class="zp">
                    <div class="outer KinerLottery KinerLotteryContent"><img src="images/zzsc.png"></div>
                    <div class="inner KinerLotteryBtn start"></div>
                </div>
                <button class="acivity_xiangqing">活动详情</button>
                <div class="zp_bom">
                    <div class="cha_usernum">
                        再邀请<span>1</span>人助力可获得一次抽奖机会
                    </div>
                    <div class="shengyu_cishu">
                        剩余抽奖次数<span>1</span>次
                    </div>
                    <input type="button" class="jilu_btn" value="我的中奖记录"/>
                    <input type="button" class="zhuli_btn" value="邀请好友助力"/>
                </div>
            </div>
        </div>
        <!-- card2 --------转盘抽奖-->


        <!-- card3----仙女榜---->
        <div class="swiper-slide">
            <div class="card_container card_container3">

                <div class="xiannv_btn_box">
                    <a href="javascript:void(0);" class="look_nvshen_guize">活动详情</a>
                    <a href="xiannv.html">仙女排行榜</a>
                    <div class="clear"></div>
                </div>

            </div>
        </div>
        <!-- card3----仙女榜---->


        <!-- card4 -达人榜-->
        <div class="swiper-slide">
            <div class="card_container card_container4">

                <div class="daren_btn_box">
                    <a href="javascript:void(0);" class="look_daren_guize" style="background: #c78cfe;">活动详情</a>
                    <a href="daren.html" style="background: #fdd185;">查看排行</a>
                    <div class="clear"></div>
                </div>

            </div>
        </div>
        <!-- card4 -->


        <!-- card5 -每日女神-->
        <div class="swiper-slide">
            <div class="card_container card_container5">
                <a href="javascript:void(0);" class="meiri_btn" id="look_meirinvshen_guize">活动详情</a>
            </div>
        </div>
        <!-- card5 -->


        <div class="swiper-slide">
            <div class="a1" style="background: transparent!important;"></div>
        </div>
    </div>
</div>
<!------------card轮播------------->


<!---转盘-规则---->
<section>
    <div class="acivity_guize acivity_guize_modal">
        <h3 class="guize_h3">本活动最终解释权归后会有期所有</h3>
    </div>
</section>
<!---转盘-规则---->

<!---人气女神-规则---->
<section>
    <div class="xiannv_guize">
        <h3 class="guize_h3">本活动最终解释权归后会有期所有</h3>
    </div>
</section>
<!---人气女神-规则---->

<!---达人榜-规则---->
<section>
    <div class="daren_guize_modal">
        <h3 class="guize_h3">本活动最终解释权归后会有期所有</h3>
    </div>
</section>
<!---达人榜-规则---->

<!---每日女神-规则---->
<section>
    <div class="meiri_guize_modal">
        <h3 class="guize_h3">本活动最终解释权归后会有期所有</h3>
    </div>
</section>
<!---每日女神-规则---->

<!---邀请助力---->
<section>
        <div class="all_black_bg7 zhuli_yaoqing_modal">
            <div class="zhuli_yaoqing">
                <img src="images/zhuliyaoqing.png" alt=""/>
            </div>
        </div>
</section>
<!---邀请助力---->

<!---中奖记录-->
<section>
    <div class="all_black_bg7 zhongjiangjilu_modal">
        <div class="distable">
            <div class="distabcell">
                <div class="zhongjiangjilu">
                    <img src="images/zhongjiangjilu_title.png" alt=""/>
                    <!--<h1>暂无记录</h1>-->
                    <div class="zhongjiangjilu_list">

                        <!--<div class="zj_jilu">
                            <div class="zhongjiang_time">2017-07-20 14:24</div>
                            <div class="zhongjiang_jine">中奖100元</div>
                            <div class="clear"></div>
                        </div>-->

                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<!---中奖记录 -->

<!---中奖奖品--modal---->
<section>
    <div class="all_black_bg7 zhongjiang_modal">
        <div class="distable zhongjiangla_bg">
            <div class="distabcell">
                <div class="zhongjiang">
                    <img src="images/zhongjiangtitleimg.png" alt=""/>
                    <div class="jiangxiang">
                        <h1>恭喜获得</h1>
                        <h2><!--5元现金奖励，请至后会有期APP进行体现，邀请10位好友助力可再获得一次抽奖机会--></h2>
                    </div>
                    <input type="button" value="邀请好友" class="yaoqing_haoyou"/>
                </div>
            </div>
        </div>
    </div>
</section>
<!---中奖奖品--modal---->

<!---不能抽奖---->
<section>
    <div class="tishi">
        <div class="distable">
            <div class="distabcell">
                <div class="tishi_val">
                    <!--对不起 &#45;&#45; 您的抽奖次数已用完-->
                </div>
            </div>
        </div>
    </div>
</section>
<!---不能抽奖---->

<!---为TA助力---->
<section>
    <div class="help_modal">
        <div class="all_black_bg7">
            <div class="distable">
                <div class="distabcell">
                    <div class="help">
                        <img src="images/close.png" class="close_help" alt=""/>
                        <div class="help_user">
                            <h1>为TA助力</h1>
                            <img src="images/tx2.jpg" class="beizhuli_userimg" alt=""/>
                            <h2>----</h2>
                            <h3>我正在申请【后会有期】APP游戏大礼包，需要你的一臂之力</h3>
                        </div>
                        <div class="zhuli_num">
                            <h2>已有<font color="#00b8e8">0</font>位玩家给TA助力</h2>
                        </div>

                        <div class="zhuli_user">
                            <!--<span class="one_zhuli_user">-->
                                <!--<img src="images/tx.jpg" alt=""/>-->
                                <!--<h6>凌琳</h6>-->
                            <!--</span>-->
                         <!--   <div class="one_zhuli_user">

                            </div>
                            <div class="one_zhuli_user">
                                <img src="images/tx.jpg" alt=""/>
                                <h6>香菱</h6>
                            </div>
                            <div class="one_zhuli_user">
                                <img src="images/tx.jpg" alt=""/>
                                <h6>阿芳</h6>
                            </div>-->

                            <div class="clear"></div>
                        </div>
                        <input type="button" value="助TA" class="btn_help" id="btn_help"/>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<!---为TA助力---->

</body>


<!--Swiper切换----获取高度-->
<script src="js/swiper.min.js"></script>
<script>
    var mySwiper1 = new Swiper('.swiper1',{
        spaceBetween: 0,
        slidesPerView : 3,
        paginationClickable: true,
        autopalyDisableOnInteraction:false
    });
    $(document).ready(function () {
        //card高度+++++
        $(".swiper1").height($(window).height()-50);
        $(".swiper1 .swiper-slide").height($(window).height()-50);
        //card高度-----
    })
</script>
<!--Swiper切换---获取高度-->


<!--load-->
<script>

    var code;
    var state;
    var beizhuli_userid = parseInt(getQueryString("userId"));
    localStorage.setItem("beizhuli_userid",beizhuli_userid);

    $(function () {
        code = getQueryString("code");
        login();
        load();
        zhuli();//    点击助力
        get_zhuli();//获取助力的人
        get_ticket();//微信分享jssdk

    });

    //    获取token
    function login() {

        if (code) {
            var isLogin = (localStorage.getItem("token") && localStorage.getItem("userid"));
            if (!isLogin) {
                $.ajax({
                    async: false,
                    type: 'post',
                    dataType: 'json',
                    url: ContextPath + 'view/login',
                    data: {"code": code},
                    success: function (json) {
                        console.dir(json);
                        //获取token之后存到本地缓存

                        if (json.success) {
                            var datas = json.data;
                            $(".shengyu_cishu").empty().append('剩余抽奖次数<span>' + datas.frequency + '</span>次');
                            localStorage.setItem("userid", datas.id);
                            localStorage.setItem("token", datas.token);
                        }
                        if (!json.success) {
                            console.dir(json.msg);
                        }

                    },
                    error: function (e) {
                        alert("获取token--" + e.status + ',' + e.statusText);
                    }
                });
            }

        }

    }

    function load() {
        //    被助力着昵称
        if(beizhuli_userid){
            $.ajax({
                type: 'post',
                dataType: 'json',
                url: ContextPath + '/view/findUserInfo',
                data: {"userId":beizhuli_userid},
                success: function (json) {
                    if (json.success) {
//                        console.dir(json.data);
                        var data = json.data;
                        $(".beizhuli_userimg").attr("src",'//tomeet-app-files.oss-cn-hangzhou.aliyuncs.com/user/'+data.id+'/avatar?x-oss-process=image/resize,m_lfit,w_200,h_200');
                        $(".help_user h2").html(data.nickname);

                    } else {
                        alert(json.msg);
                    }
                },
                error: function (e) {
                    alert("获取被助力者nickname：" + e.status + ',' + e.statusText);
                }
            });
        }
        else{
            $(".help_modal").css("display","none");
        }

        //奖池剩余金额
        $.ajax({
            type: 'post',
            dataType: 'json',
            url: ContextPath + '/view/allPrizeInfo',
            success: function (json) {
                if (json.success) {
//                    console.dir(json.data);
                    var datas = json.data;
                    $(".zp_top h1").empty().append('奖池剩余金额：' + datas.allMoney + '元');
                    $(".zp_top h2").empty().append('参与人数：' + datas.joinMember + '人');
                } else {
                    alert('获取奖池剩余金额：' + json.msg);
                }
            },
            error: function (e) {
                alert("获取奖池剩余金额error--" + e.status + ',' + e.statusText);
            }
        });

    }

    //获取助力的人
    function get_zhuli() {
        $.ajax({
            type:'post',
            dataType:'json',
            url:ContextPath+'/view/findHelped',
            data: {"userId":beizhuli_userid},
            success:function(json){
                if(json.success){
//                    console.dir(json.data);
                    var data = json.data;
                    var zhuli_usrnum = 10-parseInt(data.length);

                    $(".zhuli_num").empty().append('<h2>已有<font color="#00b8e8">'+data.length+'</font>位玩家给TA助力</h2>');
                    $(".cha_usernum").empty().append('再邀请<span>'+zhuli_usrnum+'</span>人助力可获得一次抽奖机会');
                    var $zhuli_user = $('.zhuli_user').html('');
                    var $clear = $('<div class="clear"></div>');

                    $.each(data, function (index,obj) {
                        $('<img src="'+'//tomeet-app-files.oss-cn-hangzhou.aliyuncs.com/user/'+ obj.id+'/avatar'+'" alt=""/>');
                        var $one_zhuli_user = $('<span class="one_zhuli_user"></span>');
                        $one_zhuli_user.append('<div style="display: inline-block"><img src="' + '//tomeet-app-files.oss-cn-hangzhou.aliyuncs.com/user/'+ obj.id+'/avatar?x-oss-process=image/resize,m_lfit,w_50,h_50' + '" alt=""/>'+
                                '<h6>'+obj.nickname+'</h6></div>');

                        $zhuli_user.append($one_zhuli_user);
                        $zhuli_user.append($clear);

                    });

                }else{
                    alert('获取助力人：'+json.msg);
                }

            },
            error: function (e) {
                alert("获取助力人error--"+e.status + ',' + e.statusText);
            }
        });
    }

    //    点击助力
    function zhuli() {
       var now_url = getUrlParams(location.href);
       nowstate = now_url.state;
       if(nowstate == 'help'){
           ajax_zhuli(nowstate);
       }

       $("#btn_help").on('click', function () {
           state = 'help';

           var isLogin= (localStorage.getItem("token") && localStorage.getItem("userid"));
           if(!isLogin){
//               alert('请先登陆');
               getcode();
               return;
           }
           ajax_zhuli(state);

       });
    }
    function ajax_zhuli(state) {
        if(state == 'help'){
            var param = {"helperId":parseInt(beizhuli_userid),"token":localStorage.getItem("token"),"userId":localStorage.getItem("userid")};
            $.ajax({
                type:'post',
                dataType:'json',
                url:ContextPath+'view/help',
                data: param,
                success:function(json){
//                    console.dir(json);

                    if(json.success){
                        $(".btn_help").addClass("btn_not_help");
                        $(".btn_help").val("已助力");
                        get_zhuli();
                    }
                    if(!json.success){
                        if(json.msg == '助力已存在'){
                            $(".btn_help").addClass("btn_not_help");
                            $(".btn_help").val("已助力");
                        }
                        if(json.msg == '最多助力3个人'){
                            $(".tishi").fadeIn(500);
                            $(".tishi_val").html('最多助力3个人');
                            tishi_out();
                        }
                        if(json.msg == '自己不能给自己助力'){
                            $(".tishi").fadeIn(500);
                            $(".tishi_val").html('自己不能给自己助力');
                            tishi_out();
                        }
                        if(json.msg == '登录失效'){
                            getcode();
                            return;
                        }
                        console.dir('助力errMsg：'+json.msg);
                    }

                },
                error: function (e) {
                    alert("助力error--"+e.status + ',' + e.statusText);
                }
            })
        }
    }


//    微信分享jssdk
    function get_ticket() {
        var signature;
        var noncestr;
        var timestamp;
        var urlurl;
        var nowurl = location.href;

        if(nowurl.indexOf('#') == -1){
            urlurl = nowurl;
        }
        if(nowurl.indexOf('#') !== -1){
            urlurl = get_urlurl(url);
        }

//        console.dir(urlurl);

        $.ajax({
            type:'get',
            dataType:'json',
            url:ContextPath+'/view/getWXSignature',
            data: {"url":urlurl},
            success:function(json){
                if(json.success){
//                    console.dir(json);
                    signature = json.data.signature;
                    noncestr = json.data.noncestr;
                    timestamp = json.data.timestamp;
                    wx.config({
                        debug: false, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
                        appId: 'wx59b691c92ccb58e1', // 必填，公众号的唯一标识
                        timestamp: timestamp, // 必填，生成签名的时间戳
                        nonceStr: noncestr, // 必填，生成签名的随机串
                        signature: signature,// 必填，签名，见附录1
                        jsApiList: [
                            'onMenuShareTimeline',
                            'onMenuShareAppMessage'
                        ] // 必填，需要使用的JS接口列表，所有JS接口列表见附录2
                    });

                    //        分享到朋友
                    wx.onMenuShareAppMessage({
                        title: '后会有期活动页', // 分享标题
                        desc: '一款线下组队交友神器，来参加活动有好礼送哦', // 分享描述
                        link: 'https://hzease.com/activity/index.html?userId='+localStorage.getItem("userid"), // 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致
                        imgUrl: 'https://hzease.com/images/logo200x200.png', // 分享图标
                        type: 'link', // 分享类型,music、video或link，不填默认为link
                        dataUrl: '', // 如果type是music或video，则要提供数据链接，默认为空
                        success: function () {
                            // 用户确认分享后执行的回调函数
                            console.dir('分享给朋友');
                        },
                        cancel: function () {
                            // 用户取消分享后执行的回调函数
                            console.dir('分享给朋友');
                        }
                    });

                    //        分享到朋友圈
                    wx.onMenuShareTimeline({
                        title: '后会有期活动页', // 分享标题
                        link: 'https://hzease.com/activity/index.html?userId='+localStorage.getItem("userid"), // 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致
                        imgUrl: 'https://hzease.com/images/logo200x200.png', // 分享图标
                        success: function () {
                            // 用户确认分享后执行的回调函数
                            console.dir("分享给好友成功");

                        },
                        cancel: function () {
                            // 用户取消分享后执行的回调函数
                            console.dir("分享给好友失败");

                        }
                    });
                }else{
                    console.dir(json.msg);
                }

            }
        });

    }


//    获取code
    function getcode() {
        var url_code = 'https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx1455b640ec310a00&redirect_uri=' + location.href + '&response_type=code&scope=snsapi_login&state='+state+'#wechat_redirect';
//        var url_code = 'https://open.weixin.qq.com/connect/qrconnect?appid=wx1455b640ec310a00&redirect_uri='+location.href+'&response_type=code&scope=snsapi_login&state='+state+'#wechat_redirect';
        location.href = url_code;
    }

</script>
<!--load-->


<!--模态框-->
<script>
    $(document).ready(function () {

        //-----ALL-modal---模态框
        $(".acivity_xiangqing").on('click', function () {
            $(".acivity_guize_modal").fadeIn(500);
        });
        $(".acivity_guize_modal").on('click', function () {
            $(".acivity_guize_modal").fadeOut(500);
        });
        $(".look_nvshen_guize").on('click', function () {
            $(".xiannv_guize").fadeIn(500);
        });
        $(".xiannv_guize").on('click', function () {
            $(".xiannv_guize").fadeOut(500);
        });
        $(".look_daren_guize").on('click', function () {
            $(".daren_guize_modal").fadeIn(500);
        });
        $(".daren_guize_modal").on('click', function () {
            $(".daren_guize_modal").fadeOut(500);
        });
        $(".meiri_btn").on('click', function () {
            $(".meiri_guize_modal").fadeIn(500);
        });
        $(".meiri_guize_modal").on('click', function () {
            $(".meiri_guize_modal").fadeOut(500);
        });



        $(".zhuli_btn").on('click', function () {
            $(".zhuli_yaoqing_modal").fadeIn(500);
        });
        $(".zhuli_yaoqing_modal").on('click', function () {
            $(".zhuli_yaoqing_modal").fadeOut(500);
        });

        $(".close_help").on('click', function () {
            $(".help_modal").fadeOut(1000);
        });

        //--查看中奖记录
        $(".jilu_btn").on('click', function () {
            var isLogin = (localStorage.getItem("token") && localStorage.getItem("userid"));
            if (!isLogin) {
//                alert('请先登陆');
                getcode();
                return;
            }
            $.ajax({
                type: 'post',
                dataType: 'json',
                url: ContextPath + '/view/findPrizeList',
                data: {"token": localStorage.getItem("token"), "userId": localStorage.getItem("userid")},
                success: function (json) {
                    var data = json.data;
                    console.dir(json);
                    if (!json.success) {
                        alert(json.msg);
                        getcode();
                        return;
                    }

                    if(json.success){
                        var $zhongjiangjilu_list = $(".zhongjiangjilu_list").html('');

                        $.each(data, function (index, obj) {

                            if(!obj.drawTime){
                                $(".zhongjiangjilu").empty().append('<h1>暂无记录</h1>')
                            }

                            var $zhongjiang_time = $('<div class="zhongjiang_time">' + obj.drawTime + '</div>');
                            var $zhongjiang_jine = $('<div class="zhongjiang_jine">中奖' + obj.money / 100 + '元</div>');
                            var $clear = $('<div class="clear"></div>');
                            var $zj_jilu = $('<div class="zj_jilu"></div>');
                            $zj_jilu.append($zhongjiang_time);
                            $zj_jilu.append($zhongjiang_jine);
                            $zj_jilu.append($clear);
                            $zhongjiangjilu_list.append($zj_jilu);
                        })
                    }


                }
            });
            $(".zhongjiangjilu_modal").fadeIn(500);


        });
        $(".zhongjiangjilu_modal").on('click', function () {
            $(".zhongjiangjilu_modal").fadeOut(500);
        });
        //--查看中奖记录

        $(".yaoqing_haoyou").on('click', function () {
            $(".zhongjiang_modal").fadeOut(500);
            $(".zhuli_yaoqing_modal").fadeIn(500);
        });
        $(".zhongjiang_modal").on('click', function () {
            $(".zhongjiang_modal").fadeOut(500);
        });
        //-----ALL-modal---模态框


    })

</script>
<!--模态框-->


<!-----转盘---->
<script src="js/zepto.min.js"></script>
<script src="js/zp.js"></script>
<script>
    function tishi_out() {
        setTimeout(function () {
            $(".tishi").fadeOut(500);
        },2000)
    }//提示框2秒后消失

    //------旋转角度
    var whichAward = function(deg) {
        if ((deg > 337 && deg <= 360) || (deg > 0 && deg <= 22)) { //10M流量
            return "iphone7 plus 128G黑色";
        } else if ((deg > 22 && deg <= 67)) { //50元
            return "50元";
        } else if (deg > 67 && deg <= 112) { //10元
            return "10元";
        } else if (deg > 112 && deg <= 157) { //100元
            return "100元";
        } else if (deg > 157 && deg <= 202) { //1元
            return "1元";
        } else if (deg > 202 && deg <= 247) { //3元
            return "3元";
        }else if (deg > 247 && deg <= 292) { //8888元
            return "8888元";
        }else if (deg > 292 && deg <= 337) { //5元
            return "5元";
        }
    };

    var whichJiaodu = function(jiangpin) {
        if(jiangpin == 5000){ //50元
            return 45;
        }
        if(jiangpin == 1000){ //10元
            return 90;
        }
        if(jiangpin == 10000){//100元
            return 135;
        }
        if(jiangpin == 100){//1元
            return 180;
        }
        if(jiangpin == 300){ //3元
            return 225;
        }
        if(jiangpin == 888800){//8888元
            return 270;
        }
        if(jiangpin == 500){//5元
            return 315;
        }
    };

    //------转盘
    var KinerLottery = new KinerLottery({
        rotateNum: 8, //转盘转动圈数
        body: "#zp", //大转盘整体的选择符或zepto对象
        direction: 1, //0为顺时针转动,1为逆时针转动


        clickCallback: function() {
            //此处访问接口获取奖品
            var data = window.DrawObject;
            var jiaodu =whichJiaodu(data.money);
            this.goKinerLottery(jiaodu);


        }, //点击抽奖按钮,再次回调中实现访问后台获取抽奖结果,拿到抽奖结果后显示抽奖画面

        KinerLotteryHandler: function(deg) {
            $(".zhongjiang_modal").fadeIn(500);//弹出奖品
            $(".jiangxiang h2").empty().html(whichAward(deg)+'奖励，请至后会有期APP进行体现，邀请10位好友助力可再获得一次抽奖机会');
        } //抽奖结束回调
    });
</script>
<!-----转盘---->


<!--魔窗-->
<script>
    new Mlink({
        mlink: 'AcpY',//短链地址
        button: document.querySelector('a#activity_upload'),
        autoLaunchApp: false,
        autoRedirectToDownloadUrl: true,
        downloadWhenUniversalLinkFailed: false
    });
</script>
<!--魔窗-->





</html>