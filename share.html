<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="format-detection" content="telephone=no"/>
    <title>应用邀请</title>
    <meta name="keywords" content="后会有期"/>
    <meta name="description" content="后会有期"/>
    <link rel="stylesheet" href="css/css.css" type="text/css"/>
    <script src="js/jquery-1.10.1.min.js"></script>
    <script src="js/common.js"></script>

    <!--魔窗-->
    <script src="https://static.mlinks.cc/scripts/dist/mlink.min.js"></script>

    <script type="text/javascript" src="http://webapi.amap.com/maps?v=1.3&key=9ec731c426036a64c93d46f920b47d69"></script>
    <!--<script src="js/AMap.js"></script>-->
    <script src="js/key.js" ></script>
    <link rel="stylesheet" href="css/common.css"/>
</head>
<body style="background: #eff3f6;">

<div class="yyyq_container">
    <div class="top_yyyq">
        <div class="yyyq_user">
            <img src="images/tx2.jpg" class="yyyq_user_icon" alt=""/>
            <h1><span id="yy_user"><!--小棉袄--></span>邀请你加入后会无期</h1>
            <h2>线下活动5分钟急速组队</h2>
        </div>
        <img src="images/yy1.png" class="" alt=""/>
    </div>
    <div class="lingqu_container">
        <div class="lingqu_btn">
            <span class="lingqu">
                <img src="images/bling.png" alt=""/>
                <span>点击领取</span>
            </span>
        </div>
        <img src="images/yy2.png" width="100%;" alt=""/>
        <img src="images/yy4.png" class="zuo_yy" alt=""/>
        <img src="images/yy3.png" class="you_yy" alt=""/>
    </div>


    <div class="fujintuijian">
        <h1><img src="images/map.png" alt=""/>附近推荐</h1>
        <div id="tuijian_container">
            <center>
                定位中...
            </center>
        </div>
    </div>
</div>

<!--浮在底部-->
<section>
    <div class="bom_xiazai">
        <img src="images/cha.png" class="cha" alt=""/>
        <div class="logo_info">
            <img src="images/logo.png" alt=""/>
                    <span>
                        <h3>后会有期</h3>
                        <h4>首个线下即时组队平台</h4>
                    </span>
            <div class="clear"></div>
        </div>
        <a href="" class="liji_load" id="uploadapp">打开APP</a>
    </div>
</section>

<!--选择登陆方式-->
<section>
    <div class="choose_way_modal">
        <div class="all_black_bg7">
            <div class="distable">
                <div class="distabcell">
                    <div class="login_way">
                        <h1>选择登录方式</h1>
                        <div class="all_way">
                            <div class="way_weixin">
                                <img src="images/way_wei.png" alt=""/>
                                <h5>微信</h5>
                            </div>
                            <div class="way_qq">
                                <img src="images/way_q.png" alt=""/>
                                <h5>QQ</h5>
                            </div>
                            <div class="way_phone">
                                <img src="images/way_phone.png" alt=""/>
                                <h5>手机</h5>
                            </div>
                            <div class="clear"></div>
                        </div>
                        <img src="images/close.png" class="close_modal close1" alt=""/>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!--手机验证-->
<section>
    <div class="phone_yanzheng_modal">
        <div class="all_black_bg7">
            <div class="distable">
                <div class="distabcell">
                    <div class="phone_yanzheng">
                        <form>
                            <input type="text" class="get_phonenum" placeholder="输入手机号" onblur="this.placeholder='输入手机号'" onfocus="this.placeholder=''"/>
                            <input type="button" value="验证码" class="get_yzm"/>
                            <div class="clear"></div>
                            <input type="text" class="shuru_yzm" placeholder="输入验证码" onblur="this.placeholder='输入验证码'" onfocus="this.placeholder=''"/>
                            <input type="button" class="lingqu_libao" value="领取新手大礼包"/>
                        </form>
                        <img src="images/close.png" class="close_modal close2" alt=""/>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

</body>



<script>
    $(function () {
        load();
        loadMap();
    });

    var url_canshu = getUrlParams();
//    var userId = url_canshu.userId;
//    var origin = url_canshu.origin;
//    var roomId = url_canshu.roomId;

    var userId  = getQueryString("userId");
    var origin  = getQueryString("origin");
    var roomId  = getQueryString("roomId");

    function load() {
        //ajax页面上邀请人name与头像加载
        var params2 = {"userId":userId};
//        alert("params2"+params2.userId);
        $.ajax({
            type:'post',
            dataType:'json',
            url:ContextPath+'user/findOtherInfo',
            data:params2,
            success:function(json){
                if(json.success){
                    var datas = json.data;
                    $('.yyyq_user_icon').attr('src','http://tomeet-app-files.hzease.com/user/'+datas.id+'/avatar');
                    $("#yy_user").append(datas.nickname);
                }else{
                    alert("失败-未获取到邀请人以及头像");
                }
            }
        });

        $(".game_img_div").height($(".game_info").height());
        //应用邀请--手机验证、登录方式。模态框开关控制
        $(".lingqu_btn").click(function () {
            $(".choose_way_modal").fadeIn(500);
        });
        $(".close1").click(function () {
            $(".choose_way_modal").fadeOut(200)
        });
        $(".close2").click(function () {
            $(".phone_yanzheng_modal").fadeOut(200);
        });

        $(".way_phone").click(function () {
            $(".choose_way_modal").fadeOut(1000);
            $(".phone_yanzheng_modal").fadeIn(500);
        });

        //验证码获取
        $(".get_yzm").click(function () {
            var params3={};
            var phone=$(".get_phonenum").val();
            if(!checkMobile(phone)){
                alert("手机号码不正确");
            }
            else{
                var params3 = {"phone":phone}
            }

            $.ajax({
                type:'post',
                dataType:'json',
                url:ContextPath+'user/getSmsCode',
                data:params3,
                success:(function (json) {
//                    console.dir(json);
                })
            });
        })
    }

    //高德获取位置
    function loadMap(){
        mapObj = new AMap.Map('iCenter');
        mapObj.plugin('AMap.Geolocation', function () {
            geolocation = new AMap.Geolocation({
                timeout: 10000,          //超过10秒后停止定位，默认：无穷大
            });
            mapObj.addControl(geolocation);
            geolocation.getCurrentPosition();
            AMap.event.addListener(geolocation, 'complete', function () {
                window.position=arguments[0].position;
                var params={"gameId":0,"longitude":position.M,"latitude":position.O,"page":0,"size":10,"state":0};
                $.ajax({
                    type:'post',
                    dataType:'json',
                    url:ContextPath+'/room/findRoomsByGameOrder',
                    data:params,
                    success:function(json){
                        if(json.success){
                            var datas = json.data;
                            var $tuijianContainer=$('#tuijian_container').html('');
                            $.each(datas, function (index,obj) {
                                var $tuijian=$('<div class="tuijian"><div class="game_img_div"><div class="distable"><div class="distabcell"><img src="http://www.hzease.com/game/'+obj.game.id+'.png" class="game_img" alt=""/></div></div></div></div>');
                                var $gameInfo=$(' <div class="game_info">'+
                                        '<h5 class="game_name">'+obj.name+'</h5>'+
                                        '<div class="place_container">'+
                                        '<div class="place_info">'+obj.place+'</div>'+
                                        '<div class="distance_info">'+getjuli(obj.latitude,obj.longitude,position.O,position.M)+'km</div>'+
                                        '<div class="game_time"><img src="images/mi.png" alt=""/><img src="images/bao.png" alt=""/>'+
                                        dateTimeFormat(Date.parse(obj.beginTime))+'</div><div class="clear"></div></div>');
                                var $imgContainer=  $('<div class="adduser_tx"></div>');
                                $.each(obj.joinMembers,function(i,o){
                                    var $img=$('<img src="'+'http://tomeet-app-files.hzease.com/user/'+ o.id+'/avatar'+'" alt=""/>');
                                    $imgContainer.append($img);
                                });
                                $gameInfo.append($imgContainer);
                                $tuijian.append($gameInfo);
                                var $clear=$('<div class="clear"></div>');
                                $tuijian.append($clear);
                                $tuijianContainer.append($tuijian);
                            })
                        }else{
                            console.dir(datas.message);
                        }
                    }
                });
            });//返回定位信息
            AMap.event.addListener(geolocation, 'error', function () {
                console.log("定位失败");
            });      //返回定位出错信息
        })
    }


</script>

<!--魔窗-->
<script>
    new Mlink({
        mlink:'AcpY',//短链地址
        button:document.querySelectorAll('a#uploadapp'),
        autoLaunchApp : false,
        autoRedirectToDownloadUrl: true,
        downloadWhenUniversalLinkFailed: false,
        inapp : false,
        params: {action:'share', key1:userId, key2:origin}
    });
</script>

</html>