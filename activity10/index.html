<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="format-detection" content="telephone=no"/>
    <meta http-equiv="Expires" content="0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Cache-control" content="no-cache">
    <meta http-equiv="Cache" content="no-cache">
    <title>后会有期10月活动</title>
    <meta name="keywords" content="后会有期10月活动"/>
    <meta name="description" content="后会有期10月活动"/>

    <script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.js"></script>
    <script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>

    <script src="https://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script><!--微信JSsdk-->
    <!--魔窗-->
    <script src="https://static.mlinks.cc/scripts/dist/mlink.min.js"></script>

    <!-- 接口前缀-->
    <script src="js/key.js"></script>
    <script src="js/common.js"></script>

    <link rel="stylesheet" href="css/index.css"/>
    <link rel="stylesheet" href="css/common.css"/>
</head>
<body style="background: #282828;">

<div class="activity10_container">
    <!--sec1-->
    <div class="index_sec index_sec1" id="ping1">
        <div class="indexsec_pad">
            <div class="sec1_jine" id="sec1_jine1"><!--活动池：￥1000000--></div>
            <div class="sec1_jine" id="sec1_jine2"><!--活动池：￥1000000--></div>
            <div class="scroll_container">
                <div class="zuixinjl">最新奖励</div>
                <div id="demo_1">
                    <div id="marqueeee" height="auto">
                        <ul id="demo3">
                            <!--<li></li>-->
                        </ul>
                        <ul id="demo4"></ul>
                    </div>
                </div>
            </div>
            <a class="btn_share" id="btn_share">分享</a>
        </div>
        <!--<img src="images/jt.png" class="btnjt" id="btnjt1" alt="">-->
    </div>
    <!--sec1-->

    <!--sec2-->
    <div class="index_sec index_sec2" id="ping2">
        <div class="indexsec_pad2">
            <div class="btn_con">
                <div class="btn_tab1" onclick="fnTabBoxShow(this,2,1);"></div>
                <div class="btn_tab2" onclick="fnTabBoxShow(this,2,2);"></div>
                <div class="clear"></div>
            </div>
            <div id="TabShow1" class="TabHide2">
                <h6>1. 4人及以上人数活动每人每次活动可领取10元，4人以下活动每人5元,  4人以上房主获得人数*2元</h6>
                <h5><span>例：</span>2人活动房主=5元，成员=5元</h5>
                <h5>4人活动房主=10元，成员=10元</h5>
                <h5>12人活动房主=24元，成员=10元</h5>
                <h6>2. 必须是在后会有期APP上组队参与的活动（可自建）</h6>
                <h6>3. 每场活动人员不能重复（至少1人不重复）</h6>
                <h6>4. 必须所有人签到（在活动地点点击签到按钮）</h6>
                <h6>5. 必须是真实活动，检测到虚假刷钱行为永久取消资格</h6>
                <h6>6. 需要公开房间，不允许设置房间密码</h6>
                <h6>7. 可重复参与活动。</h6>
                <h6>8. 领取后可去保证金页面提现至支付宝。</h6>
                <h6>9. 本活动后会有期拥有最终解释权。</h6>

            </div>
            <div id="TabShow2" class="TabHide2" style="display: none">
                <div class="TabHide2_container">
                    ?
                </div>
            </div>
        </div>
        <!--<img src="images/jt.png" class="btnjt" id="btnjt2" alt="">-->
    </div>
    <!--sec2-->
    <div class="hrhr"></div>
    <!--sec3-->
    <div class="index_sec index_sec3" id="ping3">
        <div class="indexsec_pad2">
            <div class="myacity">我参与的活动</div>
            <div class="act_container">
                <!--<div class="oneact">-->
                    <!--<div>-->
                        <!--<div class="l_act">篮球组队，约否！！！</div>-->
                        <!--<div class="r_act">审核中</div>-->
                        <!--<div class="clear"></div>-->
                    <!--</div>-->
                    <!--<div class="onestate">状态：审核中</div>-->
                <!--</div>-->

            </div>
            <a href="javascript:void(0);" class="btn_uploadAPP" id="btn_uploadAPP">下载后会有期APP</a>
        </div>
    </div>
    <!--sec3-->
</div>



<!---tishi---->
<div class="tishi">
    <div class="distable">
        <div class="distabcell">
            <div class="tishi_val">
            </div>
        </div>
    </div>
</div>
<!---tishi---->

<!---邀请助力提示---->
<div class="all_black_bg7 zhuli_yaoqing_modal">
    <div class="zhuli_yaoqing">
        <img src="images/zhuliyaoqing.png" class="share_pengyou" alt=""/>
        <img src="images/iknow.png" class="iknow" alt="">
    </div>
</div>
<!---邀请助力提示---->
</body>


<script>
    $(document).ready(function () {
        $(".index_sec1").height($(window).height());
        $(".btn_tab1").click(function () {
            $(this).removeClass("hover1_bg");
            $(".btn_tab2").removeClass("hover2_bg");
        });
        $(".btn_tab2").click(function () {
            $(this).addClass("hover2_bg");
            $(".btn_tab1").addClass("hover1_bg");
        });
        //modal--hide-show
        $("#btn_share").click(function () {
            $(".zhuli_yaoqing_modal").fadeIn(500);
        });
        $(".zhuli_yaoqing_modal").click(function () {
            $(".zhuli_yaoqing_modal").fadeOut(500);
        });
        //modal--hide-show
    });
    function tishi_out() {
        setTimeout(function () {
            $(".tishi").fadeOut(500);
        }, 1500)
    };//提示框2秒后消失
    function fnTabBoxShow(Focus,Hide,Show){
        $(Focus).siblings().removeClass("active");
        $(".TabHide"+Hide).hide();
        $("#TabShow"+Show).show();
    };
</script>
<script>
$(document).ready(function () {
    $.ajax({
        async: false,
        type: 'post',
        dataType: 'json',
        url: ContextPath + 'oct/findRewardUsers',
        data: {"size": 100},
        success: function (json) {
            console.dir(json);
            var data = json.data;
            if (json.success) {
                var $demo3 = $("#demo3").html('');
                $.each(data,function (index,obj) {
                    var $li = $('<li>'+obj.nickname+'刚刚在'+obj.roomName+'活动中获得了'+parseInt(obj.bounty/100)+'元</li>');
                    $demo3.append($li);
                })
                if(data == null){
                    var $demo3 = $("#demo3").html('<li>暂无</li>');
                }
            }
            if (!json.success) {
                console.dir(json.msg);
            }
        }
    });
    $.ajax({
        type: 'post',
        dataType: 'json',
        url: ContextPath + 'oct/findAllPrizeInfo',
        success: function (json) {
            console.dir(json);
            var data = json.data;
            if (json.success) {
                $("#sec1_jine1").html('活动池：￥'+parseInt(data/100));
            }
            if (!json.success) {
                $("#sec1_jine1").fadeOut();
            }
        }
    });
});

    var speed = 50;
    var demo4 = document.getElementById('demo4');
    var demo3 = document.getElementById('demo3');
    var demo_1 = document.getElementById('demo_1');
    demo4.innerHTML = demo3.innerHTML;

    function Marquee1() {
        if (demo4.offsetTop - demo_1.scrollTop <= 0)
            demo_1.scrollTop =demo_1.scrollTop- demo3.offsetHeight;
        else {
            var tmp1 = demo_1.scrollTop;
            demo_1.scrollTop++;
            if (demo_1.scrollTop == tmp1) {
                demo_1.scrollTop = -5;
            }
        }
    }
    var MyMar1 = setInterval(Marquee1, speed);
    demo_1.onmouseover = function () {
        clearInterval(MyMar1)
    };
    demo_1.onmouseout = function () {
        MyMar1 = setInterval(Marquee1, speed)
    };
</script>
<!--load-->
<script>
    var code;
    var url_userid = parseInt(getQueryString("userId"));
    if(!url_userid){
        if(localStorage.getItem("userid")){
            url_userid = localStorage.getItem("userid");
        } else{
            getcode();
        }
    }
    $(function () {
        code = getQueryString("code");
        isInapp();
        load();
        login();//获取token
        get_ticket();//微信分享jssdk
    });
    function isInapp() {
        var inapp = getQueryString("inapp");
        var appuser = getQueryString("appuser");
        var apptoken = getQueryString("apptoken");
        if (inapp) {
            localStorage.setItem("userid", appuser);
            localStorage.setItem("token", apptoken);
        }
    }

    function load() {
        var islogin_ = (localStorage.getItem("userid") && localStorage.getItem("token"));
        if(!islogin_){
            getcode();
            return;
        }else{
            $.ajax({
                type: 'post',
                dataType: 'json',
                url: ContextPath + 'oct/findMyJoinedRoom',
                data: {"userId": localStorage.getItem("userid"),"token": localStorage.getItem("token")},
                success: function (json) {
                    console.dir(json);
                    var data = json.data;
                    if (json.success) {
                        if(data == null){
                            $(".act_container").html('<h5>暂无</h5>');
                            return;
                        }
                        var $act_container = $(".act_container").html('');
                        var mymoney = 0;
                        $.each(data,function (index,obj) {
                            var $oneact = $('<div class="oneact"></div>');
                            var lingqu = '';
                            var message = '';
                            if(obj.state == 0){
                                lingqu = '审核中';
                                message = '审核中';
                            }else if(obj.state == 1){
                                lingqu = '<div class="lingqu">领取￥'+parseInt(obj.bounty/100)+'</div>';
                                message = '已发放奖励';
                            }else if(obj.state == 2){
                                lingqu = '已领取';
                                message = '已领取'+parseInt(obj.bounty/100)+'元';
                                mymoney+=obj.bounty;
                            }else if(obj.state == 3){
                                lingqu = '审核未通过';
                                message = obj.message;
                            }
                            $("#sec1_jine2").html('已获得 ￥'+parseInt(mymoney/100));
                            var $div = $('<div>'+
                                '<div class="l_act">'+obj.roomName+'</div>'+
                                '<div class="r_act" id="'+obj.id+'">'+lingqu+'</div>'+
                                '<div class="clear"></div>'+
                                '</div>');
                            var $onestate = $('<div class="onestate">提示：'+message+'</div>');
                            $oneact.append($div);
                            $oneact.append($onestate);
                            $act_container.append($oneact);
                        });

                        $(".act_container").find(".lingqu").on('click',function () {
                            var thisparent = $(this).parent();
                            var dataId = thisparent.attr("id");
                            var thisTS = $(this).parent().parent().parent().find(".onestate");
                            console.dir(dataId);
                            $.ajax({
                                type: 'post',
                                dataType: 'json',
                                url: ContextPath + 'oct/getBounty',
                                data: {
                                    "id": dataId,
                                    "userId": localStorage.getItem("userid"),
                                    "token": localStorage.getItem("token")
                                },
                                success: function (json) {
                                    console.dir(json);
                                    if (json.success) {
                                       load();
                                    }
                                    if (!json.success) {
                                        if (json.msg == '您有非法记录，领取失败。') {
                                            thisTS.html('因您有作弊行为，无法发放奖励');
                                            $(".tishi_val").html('您有非法记录，不能领取');
                                            $(".tishi").fadeIn(200);
                                            tishi_out();
                                            return;
                                        }
                                        if (json.msg == '领取失败') {
                                            $(".tishi_val").html('领取失败，请稍后重试');
                                            $(".tishi").fadeIn(200);
                                            tishi_out();
                                            return;
                                        }
                                        if (json.msg == '数据不存在') {
                                            $(".tishi_val").html('奖励已领取或不存在，请稍后重试');
                                            $(".tishi").fadeIn(200);
                                            tishi_out();
                                            return;
                                        }
                                    }
                                },
                                error: function (e) {
                                    console.dir(e);
                                }
                            });

                        })

                    }
                    if (!json.success){
                        $(".act_container").html('暂无');
                        if (json.msg == '登录失效') {
                            getcode();
                            return;
                        }
                        if (json.msg == '用户ID不存在') {
                            getcode();
                            return;
                        }
                    }
                }
            });
        }

    }

    //    获取token
    function login() {
        if (code) {
            var isLogin = (localStorage.getItem("token") && localStorage.getItem("userid"));
            if (!isLogin) {
                $.ajax({
                    async: false,
                    type: 'post',
                    dataType: 'json',
                    url: ContextPath + 'view/login',
                    data: {"code": code},
                    success: function (json) {
//                        console.dir(json);
                        //获取token之后存到本地缓存
                        if (json.success) {
                            var data = json.data;
                            localStorage.setItem("userid", data.id);
                            localStorage.setItem("token", data.token);
                        }
                        if (!json.success) {
                            console.dir(json.msg);
                        }
                    },
                    error: function (e) {
                        console.dir('获取token失败');
                    }
                });
            }
        }
    }

    //微信分享jssdk
    function get_ticket() {
        var signature;
        var noncestr;
        var timestamp;
        var urlurl;
        var nowurl = location.href;

        if (nowurl.indexOf('#') == -1) {
            urlurl = nowurl;
        }
        if (nowurl.indexOf('#') !== -1) {
            urlurl = get_urlurl(url);
        }

        $.ajax({
            type: 'get',
            dataType: 'json',
            url: ContextPath + '/view/getWXSignature',
            data: {"url": urlurl},
            success: function (json) {
                if (json.success) {
//                    console.dir(json);
                    signature = json.data.signature;
                    noncestr = json.data.noncestr;
                    timestamp = json.data.timestamp;
                    wx.config({
                        debug: false, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
                        appId: 'wx59b691c92ccb58e1', // 必填，公众号的唯一标识
                        timestamp: timestamp, // 必填，生成签名的时间戳
                        nonceStr: noncestr, // 必填，生成签名的随机串
                        signature: signature,// 必填，签名，见附录1
                        jsApiList: [
                            'onMenuShareTimeline',
                            'onMenuShareAppMessage'
                        ] // 必填，需要使用的JS接口列表，所有JS接口列表见附录2
                    });
                    wx.ready(function(){
                        // config信息验证后会执行ready方法，所有接口调用都必须在config接口获得结果之后，config是一个客户端的异步操作，所以如果需要在页面加载时就调用相关接口，则须把相关接口放在ready函数中调用来确保正确执行。对于用户触发时才调用的接口，则可以直接调用，不需要放在ready函数中。
                        var shareLinkUrl = 'https://hzease.com/activity10/index.html';
                        if (localStorage.getItem("userid")) {
                            shareLinkUrl = 'https://hzease.com/activity10/index.html?userId=' + localStorage.getItem("userid");
                        } else if (url_userid) {
                            shareLinkUrl = 'https://hzease.com/activity10/index.html?userId=' + url_userid;
                        }

                        //        分享到朋友
                        wx.onMenuShareAppMessage({
                            title: '神秘宝藏', // 分享标题
                            desc: '参加线下活动，挖掘神秘宝藏', // 分享描述
                            link: shareLinkUrl, // 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致
                            imgUrl: 'https://hzease.com/activity10/banner/share.png', // 分享图标
                            type: 'link', // 分享类型,music、video或link，不填默认为link
                            dataUrl: '', // 如果type是music或video，则要提供数据链接，默认为空
                            success: function () {
                                // 用户确认分享后执行的回调函数
                                console.dir('分享给朋友成功');
                                location.href = shareLinkUrl;
                            },
                            cancel: function () {
                                // 用户取消分享后执行的回调函数
                                console.dir('分享给朋友失败');
                            }
                        });

                        //        分享到朋友圈
                        wx.onMenuShareTimeline({
                            title: '神秘宝藏', // 分享标题
                            link: shareLinkUrl, // 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致
                            imgUrl: 'https://hzease.com/activity10/banner/share.png', // 分享图标
                            success: function () {
                                // 用户确认分享后执行的回调函数
                                console.dir("分享给好友成功");
                                location.href = shareLinkUrl;
                            },
                            cancel: function () {
                                // 用户取消分享后执行的回调函数
                                console.dir("分享给好友失败");
                            }
                        });
                    });
                    wx.error(function(res){
                        // config信息验证失败会执行error函数，如签名过期导致验证失败，具体错误信息可以打开config的debug模式查看，也可以在返回的res参数中查看，对于SPA可以在这里更新签名。
                        console.dir(res)
                    });
                } else {
                    console.dir(json.msg);
                }

            }
        });
    }

    //    获取code
    function getcode() {
        localStorage.clear();
        var url_code = 'https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx1455b640ec310a00&redirect_uri=' + location.href + '&response_type=code&scope=snsapi_login&state=1#wechat_redirect';
//        var url_code = 'https://open.weixin.qq.com/connect/qrconnect?appid=wx1455b640ec310a00&redirect_uri='+location.href+'&response_type=code&scope=snsapi_login&state='+state+'#wechat_redirect';
        location.href = url_code;
    }

    function returnJson(type) {
        var s = '{"title":"神秘宝藏","message":"参加线下活动，挖掘神秘宝藏","url":"https://hzease.com/activity10/index.html","image":"https://hzease.com/activity10/banner/share.png"}';
        if (type == 'ios')
            return s;
        else
            return JSON.parse(s);
    }
</script>
<!--load-->

<!--魔窗-->
<script>
    new Mlink({
        mlink: 'AcpY',//短链地址
        button: document.querySelector('a#btn_uploadAPP'),
        autoLaunchApp: false,
        autoRedirectToDownloadUrl: true,
        downloadWhenUniversalLinkFailed: false
    });
</script>
<!--魔窗-->

</html>